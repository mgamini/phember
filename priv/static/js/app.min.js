window.App=Ember.Application.create({LOG_TRANSITIONS:!0,PLATFORMS:["android","editor","ios","osx","linux","windows"],PHOENIX_ENDPOINT:location.protocol.match(/^https/)?"wss://"+location.host+"/ws":"ws://"+location.host+"/ws"});var map=Ember.ArrayPolyfills.map;App.ApplicationStore=DS.Store.extend(),App.PhoenixController=Ember.Controller.extend({socket:null,topics:Ember.Map.create(),init:function(){var e=new Phoenix.Socket(App.PHOENIX_ENDPOINT);this.set("socket",e),e.onClose=this.get("handleClose").bind(this)},addTopic:function(e,t,n,o){this.get("socket").join(e,t,n||{},o||function(){})},handleClose:function(){console.log("connection closed")}}),App.PhoenixSessionController=Ember.Controller.extend({needs:["phoenix"],init:function(){var e=this.get("controllers.phoenix");console.log(e)}});var Transaction=Ember.Object.extend({});App.ListLinkComponent=Ember.Component.extend({tagName:"li",classNameBindings:["active"],active:function(){return this.get("childViews").anyBy("active")}.property("childViews.@each.active")}),App.LoginController=Ember.Controller.extend({needs:["service:session"],actions:{logIn:function(){this.get("service:session").send("join",{token:"tokentokentoken",id:123456789},this.get("logInSuccess"),this.get("logInFailure"))}},logInSuccess:function(){console.log("success",arguments)},logInFailure:function(){console.log("failure",arguments)}}),App.NavigationController=Ember.ArrayController.extend({needs:["service:session","login"],model:Ember.A([Ember.Object.create({title:"Posts",location:"posts",active:null})]),title:"Phember",isLoggedIn:Ember.computed.alias("service:session.isAuthenticated"),actions:{logIn:function(){this.get("controllers.login").send("logIn")}}}),App.PostsIndexController=Ember.ArrayController.extend({}),App.PostController=Ember.Controller.extend({}),App.Author=DS.Model.extend({first_name:DS.attr("string"),last_name:DS.attr("string"),posts:DS.hasMany("post")}),App.Post=DS.Model.extend({title:DS.attr("string"),body:DS.attr("string"),author:DS.belongsTo("author")}),App.Router.map(function(){this.route("login"),this.route("logout"),this.resource("posts",function(){})}),App.IndexRoute=Ember.Route.extend({}),DS.PhoenixSocketAdapter=DS.RESTAdapter.extend({needs:["phoenix","session"],_initialized:!1,_transactions:{},_channel:null,setSocket:function(){this.container.lookup("service:phoenix").addTopic("session","data",{},this.get("setSocketResponse").bind(this))},setSocketResponse:function(e){e.on("data",this.get("onData").bind(this)),this.set("_channel",e),this.set("_initialized",!0)},onData:function(e){console.log("got data: ",e)},ajax:function(e,t,n){var o=this.get("generateUuid")(),i=this.get("_transactions")[o]=DS.PhoenixTransaction.create({uuid:o,channel:this.get("_channel")});return i.send(e,t,n),i.promise},generateUuid:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:7&n|8).toString(16)});return t}}),DS.PhoenixTransaction=Ember.Object.extend({uuid:null,promise:null,success:null,error:null,channel:null,init:function(){var e=new Ember.RSVP.Promise(function(e,t){this.set("success",function(t){Ember.run(null,e,t)}),this.set("error",function(e){Ember.run(null,t,e)})}.bind(this));this.set("promise",e)},send:function(e,t,n){var o={uuid:this.get("uuid"),type:t,params:n,path:this.get("derivePath")(e)};this.get("channel").send("data",o)},derivePath:function(e){return e.replace(this.host,"")}}),App.PhoenixSocket=Ember.Controller.extend({socket:null,topics:null,init:function(){this.set("topics",Ember.Map.create());var e=new Phoenix.Socket(App.PHOENIX_ENDPOINT);e.onClose=this.get("handleClose").bind(this),this.set("socket",e)},addTopic:function(e,t,n,o){var i=e+":"+t;this.get("topics").get(i)?o(this.get("topics").get(i),!0):this.get("socket").join(e,t,n||{},this.get("handleAddTopic").bind(this,i,o))},handleAddTopic:function(e,t,n){n.on("join",function(o){this.get("topics").set(e,n),t(n,o)}.bind(this)),n.on("error",function(e){t("error",e)})},handleClose:function(){console.log("connection closed")}}),App.PhoenixSession=Ember.Controller.extend({needs:["phoenix"],channel:null,isAuthenticated:!1,init:function(){},actions:{join:function(e,t,n){this.get("service:phoenix").addTopic("session","user",e,function(e,o){"error"==e?n(o):(this.set("isAuthenticated",!0),this.set("channel",e),t(o))}.bind(this))}}}),Ember.onLoad("Ember.Application",function(e){e.initializer({name:"session",initialize:function(e,t){t.register("service:session",App.PhoenixSession,{singleton:!0}),t.inject("controller","service:session","service:session")}}),e.initializer({name:"phoenix",initialize:function(e,t){t.register("service:phoenix",App.PhoenixSocket,{singleton:!0}),t.register("adapter:phoenix",DS.PhoenixSocketAdapter,{singleton:!0}),App.ApplicationAdapter=DS.PhoenixSocketAdapter,e.lookup("adapter:application").setSocket(),t.inject("service:session","service:phoenix","service:phoenix")}})}),App.Utils={camelizeObj:function(e){var t={};return Object.keys(e).forEach(function(n){t[Ember.String.camelize(n)]=e[n]}),t},typeChecker:function(e){return"object"==typeof e?e instanceof Array?"array":"object":typeof e},findIdx:function(e,t,n){var o=null;return e.some(function(e,i){e&&e[t]==n&&(o=i)}),o},authCookie:{toObj:function(e){try{return JSON.parse(atob(e))}catch(t){return!1}},fromObj:function(e){try{return bota(JSON.stringify(e))}catch(t){return!1}}}},App.NavigationView=Ember.View.extend({tagName:"nav",classNames:["top-bar","navbar"],templateName:"navigation"}),App.PostView=Ember.View.extend({});